config {
  type: "incremental",
  uniqueKey: ["pipeline_id"],
  schema: "marketing"
}

SELECT DISTINCT * EXCEPT(row_number)
FROM (
SELECT *,
    ROW_NUMBER() OVER (PARTITION BY pipeline_id ORDER BY update_time DESC) AS row_number
FROM ${ ref('raw_deal_pipeline') }
) t
WHERE t.row_number = 1
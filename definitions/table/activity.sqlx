config {
  type: "incremental",
  uniqueKey: ["activity_id"],
  schema: "sale"
}


WITH
    activity AS (
        SELECT *
        FROM ${ref('raw_activity')}
    )

SELECT DISTINCT * EXCEPT(row_number,activity_transaction_id)
FROM (
SELECT *,
    ROW_NUMBER() OVER (PARTITION BY activity_id ORDER BY update_time DESC) AS row_number
FROM activity
) t
WHERE t.row_number = 1